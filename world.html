<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Emergent World: Curiosity-Driven Blobs</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
#menu {
  position:absolute;
  top:10px; right:10px;
  width:340px; height:300px;
  background:rgba(0,0,0,0.85);
  color:#0f0;
  font-family:monospace;
  font-size:13px;
  padding:8px;
  overflow-y:auto;
  border:1px solid #0f0;
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="menu"></div>
<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const menu = document.getElementById("menu");
const achievements = new Set();
function achieve(text){
  if(achievements.has(text)) return;
  achievements.add(text);
  menu.innerHTML += "âœ“ " + text + "<br>";
  menu.scrollTop = menu.scrollHeight;
}

/* ===== WORLD SETTINGS ===== */
const TILE = 18;
const COLS = Math.floor(canvas.width/TILE);
const ROWS = Math.floor(canvas.height/TILE);
const world = [];
const pheromones = [];
let time = 0;

/* ===== WEATHER ===== */
let weather="clear";
function updateWeather(){if(Math.random()<0.002) weather = (weather==="clear")?"rain":"clear";}

/* ===== TEMPERATURE ===== */
function getTileTemp(x,y){
  let base={water:10, beach:18, forest:20, plains:22, mountain:5, ice: -5, ruins:15}[world[y][x]];
  let temp = base + Math.sin(time/600)*5;
  if(weather==="rain") temp-=2;
  return temp;
}

/* ===== HANDCRAFTED MAP ===== */
function generateWorld() {
  for(let y=0;y<ROWS;y++){
    world[y]=[];
    pheromones[y]=[];
    for(let x=0;x<COLS;x++){
      let t="plains";
      // Top-left ruins
      if(x<COLS*0.25 && y<ROWS*0.25) t="ruins";
      // Top-right ice
      else if(x>COLS*0.75 && y<ROWS*0.25) t="ice";
      // Bottom water
      else if(y>ROWS*0.6 && x>COLS*0.1 && x<COLS*0.9) t="water";
      // Water edges
      else if(y>ROWS*0.6 && (x<COLS*0.1 || x>COLS*0.9)) t="beach";
      // Random forests
      else if(Math.random()<0.3) t="forest";
      // Random mountains
      else if(Math.random()<0.1) t="mountain";

      world[y][x]=t;
      pheromones[y][x]=0;
    }
  }
  // Small island in water
  const ix = Math.floor(COLS*0.5), iy = Math.floor(ROWS*0.7);
  world[iy][ix]="plains";
}
generateWorld();

/* ===== FIRE ===== */
class Fire{
  constructor(x,y){this.x=x;this.y=y;this.life=80;}
  update(){
    this.life--;
    if(Math.random()<0.02){
      for(let d of [[1,0],[-1,0],[0,1],[0,-1]]){
        let nx=this.x+d[0], ny=this.y+d[1];
        if(world[ny]?.[nx]==="forest" && Math.random()<0.3) fires.push(new Fire(nx,ny));
      }
    }
  }
  draw(){ctx.fillStyle="orange";ctx.fillRect(this.x*TILE,this.y*TILE,TILE,TILE);}
}
const fires=[];

/* ===== BLOB ===== */
class Blob{
  constructor(){
    this.x=Math.floor(Math.random()*COLS);
    this.y=Math.floor(Math.random()*ROWS);
    this.hp=100; this.hunger=0; this.stamina=100; this.curiosity=0.5;
    this.memory={}; this.concepts=new Set(); this.carry=null; this.structures=[];
    this.alive=true; this.oxygen=100; this.race = Math.random()<0.5?"red":"cyan";
    // Emergent religion
    this.beliefs = [];
    this.spiritualCuriosity = Math.random()*0.3;
  }

  learn(concept){if(!this.concepts.has(concept)){this.concepts.add(concept); achieve("Discovered: "+concept);}}

  sense(tile){return (this.memory[tile]||0)+Math.random()*this.curiosity;}

  move(){
    let best=null,score=-999;
    for(let d of [[1,0],[-1,0],[0,1],[0,-1]]){
      let nx=this.x+d[0], ny=this.y+d[1];
      if(nx<0||ny<0||nx>=COLS||ny>=ROWS) continue;
      let s=this.sense(world[ny][nx]);
      if(s>score){score=s;best=d;}
    }
    if(best){this.x+=best[0]; this.y+=best[1]; this.stamina-=0.1;}
  }

  interact(){
    let tile = world[this.y][this.x];

    // Update memory
    this.memory[tile] = (this.memory[tile]||0) + 1;

    // Water & Oxygen
    if(tile==="water"){this.oxygen -=0.5; if(this.oxygen<=0){this.hp -=0.3;}}
    else {this.oxygen=100;}

    // Temperature effects
    let temp = getTileTemp(this.x,this.y);
    if(temp<0){this.hp -=0.02;}
    if(temp>35){this.hp -=0.02;}

    // Forest & Fire discovery
    if(tile==="forest"){if(Math.random()<0.002*this.memory[tile]) this.learn("fire");}

    // Stone discovery in mountains
    if(tile==="mountain"){if(!this.carry && Math.random()<0.001*this.memory[tile]){this.carry="stone"; this.learn("stone tools");}}

    // Fire interaction
    for(let f of fires){if(Math.abs(f.x-this.x)<=1 && Math.abs(f.y-this.y)<=1){
      if(this.carry==="stone" && !this.concepts.has("weapons")){this.carry="blade"; this.learn("weapons");}
      if(!this.concepts.has("heat")) this.learn("heat");
    }}

    // Architecture
    if(this.concepts.has("fire") && this.concepts.has("stone tools") && Math.random()<0.0005){
      this.structures.push({x:this.x,y:this.y});
      this.learn("architecture");
    }

    // Violence discovery
    if(this.carry==="blade" && !this.concepts.has("violence") && Math.random()<0.001) this.learn("violence");

    // Emergent religion
    if(this.hp<=0 && this.alive){this.alive=false; this.learn("death"); this.formBelief();}
    if(this.concepts.has("death")) this.formBelief();
  }

  formBelief(){
    if(Math.random() < this.spiritualCuriosity){
      let elements=[];
      if(this.concepts.has("death")) elements.push("spirits");
      if(this.concepts.has("fire")) elements.push("sky fire");
      if(weather==="rain") elements.push("water spirits");
      if(elements.length===0) elements.push("unknown");
      let belief = elements[Math.floor(Math.random()*elements.length)];
      if(!this.beliefs.includes(belief)){
        this.beliefs.push(belief);
        achieve("Blob formed belief: " + belief);
      }
    }
  }

  imitateReligion(other){
    if(other.beliefs.length>0 && Math.random()<0.02){
      let belief = other.beliefs[Math.floor(Math.random()*other.beliefs.length)];
      if(!this.beliefs.includes(belief)){
        this.beliefs.push(belief);
        achieve("Blob adopted belief: " + belief);
      }
    }
  }

  update(){
    if(!this.alive) return;
    this.hunger+=0.05;
    if(this.hunger>120){this.hp-=0.1;}
    this.move();
    this.interact();
    pheromones[this.y][this.x]+=1;
  }

  draw(){
    if(!this.alive) return;
    ctx.fillStyle=this.race;
    ctx.beginPath();
    ctx.arc(this.x*TILE+TILE/2,this.y*TILE+TILE/2,TILE/2,0,Math.PI*2);
    ctx.fill();
    if(this.carry){ctx.fillStyle=this.carry==="blade"?"silver":"gray"; ctx.fillRect(this.x*TILE+4,this.y*TILE+4,8,8);}
    for(let s of this.structures){ctx.fillStyle="#775533"; ctx.fillRect(s.x*TILE,s.y*TILE,TILE,TILE);}
  }
}

/* ===== ANIMAL ===== */
class Animal{
  constructor(){this.x=Math.floor(Math.random()*COLS); this.y=Math.floor(Math.random()*ROWS);}
  update(){let d=[[1,0],[-1,0],[0,1],[0,-1]][Math.floor(Math.random()*4)]; let nx=this.x+d[0], ny=this.y+d[1]; if(world[ny]?.[nx]!=="water"){this.x=nx; this.y=ny;}}
  draw(){ctx.fillStyle="yellow";ctx.fillRect(this.x*TILE,this.y*TILE,TILE,TILE);}
}

/* ===== ENTITIES ===== */
const blobs=[];
for(let i=0;i<14;i++) blobs.push(new Blob());
const animals=[];
for(let i=0;i<15;i++) animals.push(new Animal());

/* ===== DRAW WORLD ===== */
function drawWorld(){
  let night=Math.sin(time/600)*0.5+0.5;
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      let t=world[y][x];
      let c={
        water:"#2255cc", beach:"#c2b280", forest:"#225522",
        plains:"#44aa44", mountain:"#777777", ice:"#ffffff", ruins:"#332211"
      }[t];
      ctx.fillStyle=c; ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
    }
  }
  ctx.fillStyle=`rgba(0,0,0,${night*0.35})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);
  if(weather==="rain"){ctx.fillStyle="rgba(100,100,255,0.08)"; ctx.fillRect(0,0,canvas.width,canvas.height);}
}

/* ===== LOOP ===== */
function loop(){
  time++;
  updateWeather();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawWorld();

  for(let i=fires.length-1;i>=0;i--){fires[i].update();fires[i].draw(); if(fires[i].life<=0) fires.splice(i,1);}
  animals.forEach(a=>{a.update();a.draw();});
  blobs.forEach(b=>{
    b.update();
    b.draw();
    blobs.forEach(other=>{
      if(other!==b && Math.abs(other.x-b.x)<=3 && Math.abs(other.y-b.y)<=3){
        b.imitateReligion(other);
      }
    });
  });

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
